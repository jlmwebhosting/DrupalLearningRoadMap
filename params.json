{"name":"Drupallearningroadmap","tagline":"","body":"Welcome to Drupal Learning Road Map\r\n\r\nevent_registration.inc\r\n\r\n<?php\r\n\r\ninclude_once(drupal_get_path('module', 'webform') .\"/includes/webform.submissions.inc\");\r\n\r\nfunction event_registration_review_form($form,&$form_state)\r\n{\r\n\t\r\n\t$nid = 5;\r\n\t$node = node_load($nid);\r\n\t\r\n\t$form['er_review_form']['pi'] = array(\r\n\t\t'#type' => 'item',\r\n\t\t'#markup' => '<h3>PERSONAL INFORMATION</h3>',\r\n\t);\r\n\t\r\n\t$form['er_review_form']['member_number'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#title' => t('Member number'),\r\n\t\t'#default_value' => $node->field_member_number['und'][0]['value'],\r\n\t\t'#element_validate' => array('event_review_mnum_validate'),\r\n\t\t'#size' => 60,\r\n\t\t'#maxlength' => 128,\r\n\t\t'#required' => TRUE,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['field_first_name'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('First Name'), \r\n\t\t\t'#size' => 60, \r\n\t\t\t'#maxlength' => 128,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $node->field_first_name['und'][0]['value'],\r\n\t);\r\n\t\r\n\t$form['er_review_form']['middle_name'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#title' => t('Middle Name'),\r\n\t\t'#default_value' => $node->field_middle_name['und'][0]['value'],\r\n\t\t'#size' => 60,\r\n\t\t'#maxlength' => 128,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['last_name'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#title' => t('Last Name'),\r\n\t\t'#default_value' => $node->field_last_name['und'][0]['value'],\r\n\t\t'#size' => 60,\r\n\t\t'#maxlength' => 128,\r\n\t\t'#required' => TRUE,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['date_of_birth'] = array(\r\n\t\t'#type' => 'date',\r\n\t\t'#title' => t('Date of birth'),\r\n\t\t'#default_value' => $node->field_date_of_birth['und'][0]['value'],\r\n\t\t'#element_validate' => array('event_review_dob_validate'),\r\n\t\t'#required' => TRUE,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['date_of_event'] = array(\r\n\t\t'#type' => 'date',\r\n\t\t'#title' => t('Date of event'),\r\n\t\t'#default_value' => $node->field_date_of_event['und'][0]['value'],\r\n\t\t'#required' => TRUE,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['contact_number'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#title' => t('Contact number'),\r\n\t\t'#default_value' => $node->field_contact_number['und'][0]['value'],\r\n\t\t'#element_validate' => array('event_review_cnum_validate'),\r\n\t\t'#size' => 60,\r\n\t\t'#maxlength' => 128,\r\n\t\t'#required' => TRUE,\r\n\t);\r\n\t\r\n\t$form['er_review_form']['email'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#title' => t('Email address'),\r\n\t\t'#default_value' => $node->field_email_address['und'][0]['value'],\r\n\t\t'#element_validate' => array('event_review_email_validate'),\r\n\t);\t\r\n\t\r\n\t$form['er_review_form']['attending_with_partner'] = array(\r\n\t\t'#type' => 'checkbox',\r\n\t\t'#title' => t('Attending with a partner'),\r\n\t\t'#default_value' => $node->field_attend_with_a_partner['und'][0]['value'],\r\n\t);\r\n\t\r\n\t$form['er_review_form']['next'] = array(\r\n\t\t'#type' => 'submit',\r\n\t\t'#value' => t('Next'),\r\n\t\t'#submit' => array('event_review_submit'),\r\n\t);\r\n\t\r\n\treturn $form;\r\n}\r\n\r\nfunction event_review_mnum_validate($form, &$form_state)\r\n{\r\n\tif(!ctype_digit($form_state['values']['member_number']))\r\n\t{\r\n\t\tform_set_error('Member number','Only numbers is allowed');\r\n\t}\r\n}\r\n\r\nfunction event_review_email_validate($form, &$form_state)\r\n{\r\n\tif(!valid_email_address($form_state['values']['email']))\r\n\t{\r\n\t\tform_set_error('Email address','Not a valid email address');\r\n\t}\r\n}\r\n\r\nfunction event_review_cnum_validate($form, &$form_state)\r\n{\r\n\tif(!is_numeric($form_state['values']['contact_number']))\r\n\t{\r\n\t\tform_set_error('Contact number','Contact number is not in correct format');\r\n\t}\r\n}\r\n\r\nfunction event_review_dob_validate($form, &$form_state)\r\n{\r\n\t$dob = $form_state['values']['date_of_birth'];\r\n\t$dob_year = $dob['year'];\r\n\t$current_yr = date('Y');\r\n\t\r\n\tif($dob && ($dob_year < 1900 || $dob_year > 2015))\r\n\t{\r\n\t\tform_set_error('Date of birth','Enter a year between 1900 and current year');\r\n\t}\r\n}\r\n\r\nfunction event_review_submit($form, $form_state)\r\n{\r\n\t//print_r($form_state['values']);\r\n\t//die();\r\n\t\r\n\t$body_text = 'Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\\'s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.';\r\n\t\r\n\t$dob = date_create($form_state['values']['date_of_birth']['month'] . '-' . $form_state['values']['date_of_birth']['day'] . '-' .$form_state['values']['date_of_birth']['year']);\r\n\t\r\n\t$dob_data = date_format($dob, 'Y-m-d H:i');\r\n\t\r\n\t$doe = date_create($form_state['values']['date_of_event']['month'] . '-' . $form_state['values']['date_of_event']['day'] . '-' .$form_state['values']['date_of_event']['year']);\r\n\t\r\n\t$doe_data = date_format($doe, 'Y-m-d H:i');\r\n\t\r\n\t$node = new stdClass();\r\n\t$node->type = 'event';\r\n\tnode_object_prepare($node);\r\n\t$node->language = LANGUAGE_NONE;\r\n\t$node->status = 1;\r\n\t$node->uid = 1;\r\n\t$node->title = $form_state['values']['member_number'];\r\n\t$node->body['und'][0]['value'] = $body_text;\r\n\t$node->body['und'][0]['summary'] = '';\r\n\t$node->body['und'][0]['format'] = 'filtered_html';\r\n\t$node->body['und'][0]['safe_value'] = 'Lorem Ipsum Dolor';\r\n\t$node->field_member_number['und'][0]['value'] = $form_state['values']['member_number'];\r\n\t$node->field_first_name['und'][0]['value'] = $form_state['values']['field_first_name'];\r\n\t$node->field_middle_name['und'][0]['value'] = $form_state['values']['middle_name'];\r\n\t$node->field_last_name['und'][0]['value'] = $form_state['values']['last_name'];\r\n\t$node->field_date_of_birth['und'][0]['value'] = $dob_data;\r\n\t$node->field_date_of_event['und'][0]['value'] = $doe_data;\r\n\t$node->field_contact_number['und'][0]['value'] = $form_state['values']['contact_number'];\r\n\t$node->field_email_address['und'][0]['value'] = $form_state['values']['email'];\r\n\t$node->field_attend_with_a_partner['und'][0]['value'] = $form_state['values']['attending_with_partner'];\r\n\t$node = node_submit($node);\r\n\tnode_save($node);\r\n\t\r\n\tdrupal_set_message(\"Event activated\");\r\n\t\r\n}\r\n\r\n?>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}